[{"id":"7a14643a.75260c","type":"subflow","name":"Splitter","info":"","category":"","in":[{"x":540,"y":300,"wires":[{"id":"273108cc.4b9928"}]}],"out":[{"x":960,"y":300,"wires":[{"id":"a7524f72.576f3","port":0},{"id":"f3125664899350c0","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"273108cc.4b9928","type":"switch","z":"7a14643a.75260c","name":"","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"split","vt":"str"},{"t":"eq","v":"array","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":630,"y":300,"wires":[["fb18185d.5df9e8"],["f3125664899350c0"]]},{"id":"a7524f72.576f3","type":"split","z":"7a14643a.75260c","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":810,"y":240,"wires":[[]]},{"id":"fb18185d.5df9e8","type":"change","z":"7a14643a.75260c","name":"del topic","rules":[{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":280,"wires":[["a7524f72.576f3"]]},{"id":"f3125664899350c0","type":"change","z":"7a14643a.75260c","name":"del topic","rules":[{"t":"delete","p":"topic","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":800,"y":320,"wires":[[]]},{"id":"d1abcd4.10bc03","type":"subflow","name":"Request Timer","info":"","category":"","in":[{"x":320,"y":180,"wires":[{"id":"ae3b4275178b1b9a"}]}],"out":[{"x":860,"y":300,"wires":[{"id":"244e6655.741d9a","port":0},{"id":"6bd8af1f.89fdd","port":0},{"id":"2a5d491d.97c806","port":0},{"id":"9e7f2747.5c4628","port":0},{"id":"c2dcb099.f3e78","port":0},{"id":"9fd56572.0c0b38","port":0},{"id":"f15b3597.8713b8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"f0a2d4f4.19a288","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":480,"y":220,"wires":[["6bd8af1f.89fdd","a0bdc284.5e792"]]},{"id":"a0bdc284.5e792","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":480,"y":260,"wires":[["2a5d491d.97c806","ffdeebc6.4d7b88"]]},{"id":"244e6655.741d9a","type":"change","z":"d1abcd4.10bc03","name":"room","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"room","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":180,"wires":[[]]},{"id":"6bd8af1f.89fdd","type":"change","z":"d1abcd4.10bc03","name":"zone","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"zone","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":220,"wires":[[]]},{"id":"2a5d491d.97c806","type":"change","z":"d1abcd4.10bc03","name":"scene","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"scene","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":260,"wires":[[]]},{"id":"ffdeebc6.4d7b88","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":480,"y":300,"wires":[["c2dcb099.f3e78","b2ade02a.ff9c1"]]},{"id":"c2dcb099.f3e78","type":"change","z":"d1abcd4.10bc03","name":"device","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"device","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":300,"wires":[[]]},{"id":"9e7f2747.5c4628","type":"change","z":"d1abcd4.10bc03","name":"motion","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":340,"wires":[[]]},{"id":"b2ade02a.ff9c1","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":480,"y":340,"wires":[["9e7f2747.5c4628","db7b216c.0f12c"]]},{"id":"9fd56572.0c0b38","type":"change","z":"d1abcd4.10bc03","name":"button","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"button","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":380,"wires":[[]]},{"id":"f15b3597.8713b8","type":"change","z":"d1abcd4.10bc03","name":"light","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"topic","pt":"msg"},{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":420,"wires":[[]]},{"id":"db7b216c.0f12c","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":480,"y":380,"wires":[["9fd56572.0c0b38","5ff7e2ec.4fce7c"]]},{"id":"5ff7e2ec.4fce7c","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":480,"y":420,"wires":[["f15b3597.8713b8"]]},{"id":"ae3b4275178b1b9a","type":"delay","z":"d1abcd4.10bc03","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":480,"y":180,"wires":[["f0a2d4f4.19a288","244e6655.741d9a"]]},{"id":"aff9cdb5.1ba04","type":"subflow","name":"Scenes Room / Zones","info":"","category":"","in":[{"x":660,"y":340,"wires":[{"id":"d783c4a0.a134f8"},{"id":"b2fff99f.0b7af8"}]}],"out":[{"x":1260,"y":300,"wires":[{"id":"fb43fcd6.f6b8c","port":0}]},{"x":1260,"y":380,"wires":[{"id":"c17682ee.48568","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"b2fff99f.0b7af8","type":"split","z":"aff9cdb5.1ba04","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":840,"y":380,"wires":[["48dc6c9.51e3694"]]},{"id":"48dc6c9.51e3694","type":"switch","z":"aff9cdb5.1ba04","name":"","property":"payload.zone-name","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":990,"y":380,"wires":[["c17682ee.48568"]]},{"id":"c17682ee.48568","type":"join","z":"aff9cdb5.1ba04","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"5","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1130,"y":380,"wires":[[]]},{"id":"a1aefb6a.38dee8","type":"switch","z":"aff9cdb5.1ba04","name":"","property":"payload.room-name","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":990,"y":300,"wires":[["fb43fcd6.f6b8c"]]},{"id":"fb43fcd6.f6b8c","type":"join","z":"aff9cdb5.1ba04","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"3","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1130,"y":300,"wires":[[]]},{"id":"d783c4a0.a134f8","type":"split","z":"aff9cdb5.1ba04","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":840,"y":300,"wires":[["a1aefb6a.38dee8"]]},{"id":"4e22b0a547b71127","type":"subflow","name":"HUE Motion Receiver","info":"","category":"HUE v2","in":[{"x":40,"y":440,"wires":[{"id":"b48930eb8130de8c"}]}],"out":[{"x":870,"y":360,"wires":[{"id":"b1fa90333cd3d7c2","port":0}]},{"x":890,"y":440,"wires":[{"id":"b1fa90333cd3d7c2","port":0},{"id":"c3a995dec60ea23a","port":0}]},{"x":870,"y":520,"wires":[{"id":"c3a995dec60ea23a","port":0}]}],"env":[{"name":"motion_ID","type":"str","value":"replace with discovered Motion Sensor ID"}],"meta":{},"color":"#9876D3","outputLabels":["motion true","motion true / false","motion false"],"icon":"node-red/bridge-dash.svg"},{"id":"a53e4a4353ead5c5","type":"switch","z":"4e22b0a547b71127","name":"payload.data.0.motion.motion","property":"payload.data.0.motion.motion","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":440,"wires":[["b1fa90333cd3d7c2"],["c3a995dec60ea23a"]]},{"id":"b1fa90333cd3d7c2","type":"change","z":"4e22b0a547b71127","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":400,"wires":[[]]},{"id":"c3a995dec60ea23a","type":"change","z":"4e22b0a547b71127","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":480,"wires":[[]]},{"id":"b48930eb8130de8c","type":"switch","z":"4e22b0a547b71127","name":"Motion Sensor ID","property":"payload.data.0.id","propertyType":"msg","rules":[{"t":"cont","v":"motion_ID","vt":"env"}],"checkall":"true","repair":false,"outputs":1,"x":190,"y":440,"wires":[["a53e4a4353ead5c5"]]},{"id":"b16d682909fa8060","type":"comment","z":"4e22b0a547b71127","name":"HUE - Motion Sensor Event Filter \\n \\n Output 1: Will send just an **true** when Motion is detected \\n  \\n Output 2: Will send an **true** when Motion is detected and a **false** if no motion is detected any longer. \\n  \\n Output 3: Will send just an **false** when no Motion is detected any longer. \\n  \\n ----------------------- \\n All outputs are boolean \\n ----------------------- \\n  \\n Most easy Subflow, but convinient when lots of sensors need to be set up.","info":"Output 1:\nWill send just an **true** when Motion is detected\n\nOutput 2:\nWill send an **true** when Motion is detected and a **false** if no motion is detected any longer.\n\nOutput 3:\nWill send just an **false** when no Motion is detected any longer.\n\n-----------------------\nAll outputs are boolean\n-----------------------\n\nMost easy Subflow, but convinient when lots of sensors need to be set up.","x":380,"y":180,"wires":[]},{"id":"a481bf787a7fdeab","type":"subflow","name":"HUE Light Receiver","info":"","category":"HUE v2","in":[{"x":40,"y":580,"wires":[{"id":"f3271feba7c9915a"}]}],"out":[{"x":1020,"y":500,"wires":[{"id":"7589246b1e06008f","port":0}]},{"x":1040,"y":580,"wires":[{"id":"7589246b1e06008f","port":0},{"id":"4af07ff82cd530da","port":0}]},{"x":1020,"y":660,"wires":[{"id":"4af07ff82cd530da","port":0}]}],"env":[{"name":"light_ID","type":"str","value":"replace with discovered Lamp / Group ID"}],"meta":{},"color":"#86E3FF","outputLabels":["On","On / Off","Off"],"icon":"node-red/light.svg"},{"id":"8b5bf9aa6165443b","type":"rbe","z":"a481bf787a7fdeab","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","topi":"topic","x":730,"y":500,"wires":[["7589246b1e06008f"]]},{"id":"7589246b1e06008f","type":"switch","z":"a481bf787a7fdeab","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":850,"y":500,"wires":[[]]},{"id":"a7ba6a6bbe78ae39","type":"change","z":"a481bf787a7fdeab","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":460,"wires":[["099f85bc73efff73"]]},{"id":"099f85bc73efff73","type":"delay","z":"a481bf787a7fdeab","name":"2s","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":850,"y":460,"wires":[["8b5bf9aa6165443b"]]},{"id":"a003a94d2ebb1a69","type":"change","z":"a481bf787a7fdeab","name":"True","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":540,"wires":[["8b5bf9aa6165443b"]]},{"id":"b785268eac1e03d1","type":"delay","z":"a481bf787a7fdeab","name":"2s","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":850,"y":700,"wires":[["b836e2a7909c55e9"]]},{"id":"b836e2a7909c55e9","type":"rbe","z":"a481bf787a7fdeab","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","x":730,"y":660,"wires":[["4af07ff82cd530da"]]},{"id":"598dbd38880b8bb8","type":"change","z":"a481bf787a7fdeab","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":620,"wires":[["b836e2a7909c55e9"]]},{"id":"c3b7a3bc0f18b044","type":"change","z":"a481bf787a7fdeab","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":700,"wires":[["b785268eac1e03d1"]]},{"id":"4af07ff82cd530da","type":"switch","z":"a481bf787a7fdeab","name":"","property":"payload","propertyType":"msg","rules":[{"t":"false"}],"checkall":"true","repair":false,"outputs":1,"x":850,"y":660,"wires":[[]]},{"id":"db4b92b38d2635c5","type":"switch","z":"a481bf787a7fdeab","name":"payload.data.0.on.on","property":"payload.data.0.on.on","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":480,"y":580,"wires":[["a003a94d2ebb1a69","a7ba6a6bbe78ae39"],["598dbd38880b8bb8","c3b7a3bc0f18b044"]]},{"id":"b94463b527fd5453","type":"comment","z":"a481bf787a7fdeab","name":"HUE light / grouped_light Event Filter \\n  \\n Output 1: This output will send a **true** when Lights or Groups are turned on. \\n  \\n Output 2: This output will send a **true** when Lights or Groups are turned on AND a **false** when Lights or Groups are turned off. \\n  \\n Output 3: This output will send a **false** when Lights or Groups are turned off \\n  \\n Depending on your Situation it can be useful just to have a **true** OR **false** OR **both** states in your Flow. Thats the reason i built this Subflow. \\n Just use the Output that makes you happy :) \\n  \\n ----------------------- \\n All outputs are boolean  \\n ----------------------- \\n  \\n The delays will reset the RBE nodes. \\n You can adjust the times for your needs, but this worked for me prefectly.","info":"Output 1:\nThis output will send a **true** when Lights or Groups are turned on.\n\nOutput 2:\nThis output will send a **true** when Lights or Groups are turned on AND a **false** when Lights or Groups are turned off.\n\nOutput 3:\nThis output will send a **false** when Lights or Groups are turned off\n\nDepending on your Situation it can be useful just to have a **true** OR **false** OR **both** states in your Flow. Thats the reason i built this Subflow.\nJust use the Output that makes you happy :)\n\n-----------------------\nAll outputs are boolean \n-----------------------\n\nThe delays will reset the RBE nodes.\nYou can adjust the times for your needs, but this worked for me prefectly.","x":510,"y":220,"wires":[]},{"id":"f3271feba7c9915a","type":"switch","z":"a481bf787a7fdeab","name":"light / grouped_light ID","property":"payload.data.0.id","propertyType":"msg","rules":[{"t":"cont","v":"light_ID","vt":"env"}],"checkall":"true","repair":false,"outputs":1,"x":200,"y":580,"wires":[["db4b92b38d2635c5"]]},{"id":"f97d7e51bb5967a2","type":"subflow","name":"HUE Button Receiver","info":"","category":"HUE v2","in":[{"x":40,"y":500,"wires":[{"id":"50e9a6cafc2f5612"}]}],"out":[{"x":1230,"y":240,"wires":[{"id":"7f25389d80fa3cde","port":0}]},{"x":1240,"y":440,"wires":[{"id":"f02e878296414031","port":0}]},{"x":1210,"y":600,"wires":[{"id":"36f17c4928f045ac","port":0}]},{"x":1230,"y":760,"wires":[{"id":"45b938adbb6fe26f","port":0}]}],"env":[{"name":"button_ID","type":"str","value":"replace with discovered button ID","ui":{"type":"input","opts":{"types":["str"]}}}],"meta":{},"color":"#E6E0F8","outputLabels":["initial_press","short_release","repeat","long_release"],"icon":"font-awesome/fa-toggle-on"},{"id":"3c318b2306429e4d","type":"rbe","z":"f97d7e51bb5967a2","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","topi":"topic","x":950,"y":240,"wires":[["7f25389d80fa3cde"]]},{"id":"7f25389d80fa3cde","type":"switch","z":"f97d7e51bb5967a2","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":240,"wires":[[]]},{"id":"b6ab7fec2b8dc05e","type":"change","z":"f97d7e51bb5967a2","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":200,"wires":[["a508a630c6fee070"]]},{"id":"a508a630c6fee070","type":"delay","z":"f97d7e51bb5967a2","name":"2s","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1070,"y":200,"wires":[["3c318b2306429e4d"]]},{"id":"9a81e6607acd41c9","type":"change","z":"f97d7e51bb5967a2","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":280,"wires":[["3c318b2306429e4d"]]},{"id":"22bf2356fe704447","type":"delay","z":"f97d7e51bb5967a2","name":"2s","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1070,"y":720,"wires":[["3ffa34d7fd3607ee"]]},{"id":"3ffa34d7fd3607ee","type":"rbe","z":"f97d7e51bb5967a2","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","x":950,"y":760,"wires":[["45b938adbb6fe26f"]]},{"id":"307c3cf1d28c06e2","type":"change","z":"f97d7e51bb5967a2","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":720,"wires":[["22bf2356fe704447"]]},{"id":"2ca41635e1099306","type":"change","z":"f97d7e51bb5967a2","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":800,"wires":[["3ffa34d7fd3607ee"]]},{"id":"45b938adbb6fe26f","type":"switch","z":"f97d7e51bb5967a2","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":760,"wires":[[]]},{"id":"e0d3f900fbfb7ee8","type":"switch","z":"f97d7e51bb5967a2","name":"payload.data.0.button.last_event","property":"payload.data.0.button.last_event","propertyType":"msg","rules":[{"t":"cont","v":"initial_press","vt":"str"},{"t":"cont","v":"short_release","vt":"str"},{"t":"cont","v":"repeat","vt":"str"},{"t":"cont","v":"long_release","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":660,"y":500,"wires":[["b6ab7fec2b8dc05e","9a81e6607acd41c9"],["49066fcfb2a909b3","5aa80bc6dd152296"],["36f17c4928f045ac"],["2ca41635e1099306","307c3cf1d28c06e2"]]},{"id":"6337bd151ed3c9d7","type":"rbe","z":"f97d7e51bb5967a2","name":"","func":"rbe","gap":"","start":"","inout":"out","septopics":true,"property":"payload","x":950,"y":440,"wires":[["f02e878296414031"]]},{"id":"f02e878296414031","type":"switch","z":"f97d7e51bb5967a2","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":440,"wires":[[]]},{"id":"5aa80bc6dd152296","type":"change","z":"f97d7e51bb5967a2","name":"false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":400,"wires":[["aafcb4efbf90626a"]]},{"id":"aafcb4efbf90626a","type":"delay","z":"f97d7e51bb5967a2","name":"2s","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1070,"y":400,"wires":[["6337bd151ed3c9d7"]]},{"id":"49066fcfb2a909b3","type":"change","z":"f97d7e51bb5967a2","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":480,"wires":[["6337bd151ed3c9d7"]]},{"id":"36f17c4928f045ac","type":"change","z":"f97d7e51bb5967a2","name":"true","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":600,"wires":[[]]},{"id":"a67312d8cbdb82c5","type":"comment","z":"f97d7e51bb5967a2","name":"HUE Button Event Filter \\n  \\n Output 1: The **initial_press** comes ALWAYS directly after you push the Button. Quickest response possible! \\n  \\n Output 2: The **short_release** will just appear after the **initial_press**, when you pushed the Button quick. \\n  \\n Output 3: The **repeat** will appear if you hold the button, and will send a message every second until you release it. \\n  \\n Output 4: The **long_release** will appear after the **repeat** ENDED! \\n  \\n -------------------------------- \\n All outputs are boolean **true** \\n -------------------------------- \\n  \\n The delays will reset the RBE node with a false. \\n You can adjust the times for your needs, but this worked for me prefectly.","info":"Output 1:\nThe **initial_press** comes ALWAYS directly after you push the Button. Quickest response possible!\n\nOutput 2:\nThe **short_release** will just appear after the **initial_press**, when you pushed the Button quick.\n\nOutput 3:\nThe **repeat** will appear if you hold the button, and will send a message every second until you release it.\n\nOutput 4:\nThe **long_release** will appear after the **repeat** ENDED!\n\n\n--------------------------------\nAll outputs are boolean **true**\n--------------------------------\n\n\nThe delays will reset the RBE node with a false.\nYou can adjust the times for your needs, but this worked for me prefectly.","x":420,"y":200,"wires":[]},{"id":"50e9a6cafc2f5612","type":"switch","z":"f97d7e51bb5967a2","name":"Button ID","property":"payload.data.0.id","propertyType":"msg","rules":[{"t":"cont","v":"button_ID","vt":"env"}],"checkall":"true","repair":false,"outputs":1,"x":260,"y":500,"wires":[["e0d3f900fbfb7ee8"]]},{"id":"9b7a138fbdef3f3c","type":"tab","label":"HUE API V2","disabled":false,"info":"","env":[]},{"id":"e63309822f6aed33","type":"link out","z":"9b7a138fbdef3f3c","name":"EventStream","mode":"link","links":["7d306c301ef5b438","5319cc544f8b86f0","b24ccfa09661a404"],"x":1050,"y":360,"wires":[],"l":true},{"id":"013f2b91ba94f484","type":"debug","z":"9b7a138fbdef3f3c","name":"HUE monitor","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":830,"y":360,"wires":[]},{"id":"327d7e6fb89532d2","type":"link in","z":"9b7a138fbdef3f3c","d":true,"name":"HUE API INPUT","links":["de410684df035b13","6020f802750ac20a"],"x":220,"y":860,"wires":[["83f67f11c717b816"]],"l":true},{"id":"5aef6827752a42b5","type":"http request","z":"9b7a138fbdef3f3c","name":"HUE API V2","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"4bc31af9bd03bbdc","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":830,"y":860,"wires":[["89eb2744339cf1a0"]]},{"id":"a810d722e105f7bd","type":"link out","z":"9b7a138fbdef3f3c","d":true,"name":"API Response OUT","mode":"link","links":["c4e2900916c6fcf3"],"x":1290,"y":880,"wires":[],"l":true},{"id":"a9da3aa95f69b164","type":"function","z":"9b7a138fbdef3f3c","name":"Take snapshot \\n - or - \\n Restore snapshot \\n (retry processing) \\n +set rate max 1/250ms","func":"// Take a copy of payload & headers as they are now to be able to re-use it on retry\nif (msg.retryInfo === undefined) {\n    // msg was never processed befor, take a copy (snapshot) of key values to be re-applied in case of retry\n    msg.retryInfo = {}\n    msg.retryInfo.payload = msg.payload;\n    msg.retryInfo.headers = msg.headers;\n    msg.retryInfo.retryCount = 0;\n} else {\n    // msg was processed at least once before, apply snapshot'd values back\n    msg.payload = msg.retryInfo.payload;\n    msg.headers = msg.retryInfo.headers;\n    msg.statusCode = undefined;\n    msg.retryInfo.retryCount++\n}\n\n// Set maximum rate to 1/200ms\nmsg.rate = 200;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":880,"wires":[["36f3584b2c9a9ecd"]],"outputLabels":["Blocked msg to send to repeater"],"icon":"font-awesome/fa-copy"},{"id":"803b8069d126d0bb","type":"delay","z":"9b7a138fbdef3f3c","name":"(0.25s - 0.5s)","pauseType":"random","timeout":"1100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"250","randomLast":"500","randomUnits":"milliseconds","drop":false,"allowrate":false,"outputs":1,"x":410,"y":900,"wires":[["a9da3aa95f69b164"]]},{"id":"e634dfa743da8694","type":"debug","z":"9b7a138fbdef3f3c","name":"HUE API error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1300,"y":920,"wires":[]},{"id":"8c13309a5d266ff2","type":"link in","z":"9b7a138fbdef3f3c","name":"Retry...","links":["d9a8bfbb2349839e"],"x":285,"y":900,"wires":[["803b8069d126d0bb"]]},{"id":"d9a8bfbb2349839e","type":"link out","z":"9b7a138fbdef3f3c","name":"Try to retry...","mode":"link","links":["8c13309a5d266ff2"],"x":1195,"y":840,"wires":[]},{"id":"89eb2744339cf1a0","type":"switch","z":"9b7a138fbdef3f3c","name":"Catch Error \\n 429+503","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"429","vt":"str"},{"t":"eq","v":"503","vt":"num"},{"t":"regex","v":"2\\d\\d","vt":"str","case":false},{"t":"else"}],"checkall":"true","repair":false,"outputs":4,"x":1030,"y":900,"wires":[["4d1f0211700e0333"],["4d1f0211700e0333"],["a810d722e105f7bd"],["a810d722e105f7bd","e634dfa743da8694"]],"outputLabels":[null,"503 : too many calls sent","2xx : all OK","others (Error)"]},{"id":"36f3584b2c9a9ecd","type":"delay","z":"9b7a138fbdef3f3c","name":"Limit 1msg/s","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":true,"outputs":1,"x":830,"y":900,"wires":[["5aef6827752a42b5"]]},{"id":"4d1f0211700e0333","type":"switch","z":"9b7a138fbdef3f3c","name":"Max 10 retries","property":"retryInfo.retryCount","propertyType":"msg","rules":[{"t":"lt","v":"10","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1040,"y":840,"wires":[["d9a8bfbb2349839e"],["a810d722e105f7bd","e634dfa743da8694"]],"outputLabels":["Less than 10 errors, keep retrying...","More than 10 errors, abord retries"]},{"id":"f04263f3d94f4a0b","type":"philipshue-events","z":"9b7a138fbdef3f3c","bridge":"","x":360,"y":360,"wires":[["e3c338ee51333408"]]},{"id":"8fbba406a2f129f3","type":"subflow:f97d7e51bb5967a2","z":"9b7a138fbdef3f3c","name":"","env":[{"name":"button_ID","value":"replace with discovered button <<ID>>","type":"str"}],"x":320,"y":1920,"wires":[["2aceb545818e84db"],["7858ed4e932a4a72"],["8fee0de2f5785cb7"],["e6380f16e7c065d1"]]},{"id":"c8a85c32bc5767cc","type":"subflow:a481bf787a7fdeab","z":"9b7a138fbdef3f3c","name":"","env":[{"name":"light_ID","value":"replace with discovered Lamp ID / Group RID","type":"str"}],"x":330,"y":1440,"wires":[["71eefb32f43ce393"],["37e4d7a45b669ada"],["eb0ae848c39ce94b"]]},{"id":"68baecbeac7c3e04","type":"subflow:4e22b0a547b71127","z":"9b7a138fbdef3f3c","name":"","env":[{"name":"motion_ID","value":"replace with discovered Motion Sensor <<ID>>","type":"str"}],"x":320,"y":1680,"wires":[["38c564b4a44f0673"],["557d0d89e40bef96"],["b80d07b3eeeb81e5"]]},{"id":"2aceb545818e84db","type":"debug","z":"9b7a138fbdef3f3c","name":"initial","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":550,"y":1860,"wires":[]},{"id":"7858ed4e932a4a72","type":"debug","z":"9b7a138fbdef3f3c","name":"short","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":550,"y":1900,"wires":[]},{"id":"8fee0de2f5785cb7","type":"debug","z":"9b7a138fbdef3f3c","name":"holded","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":550,"y":1940,"wires":[]},{"id":"e6380f16e7c065d1","type":"debug","z":"9b7a138fbdef3f3c","name":"long","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":550,"y":1980,"wires":[]},{"id":"38c564b4a44f0673","type":"debug","z":"9b7a138fbdef3f3c","name":"motion true","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":570,"y":1640,"wires":[]},{"id":"557d0d89e40bef96","type":"debug","z":"9b7a138fbdef3f3c","name":"motion true + false","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":590,"y":1680,"wires":[]},{"id":"b80d07b3eeeb81e5","type":"debug","z":"9b7a138fbdef3f3c","name":"motion false","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":570,"y":1720,"wires":[]},{"id":"71eefb32f43ce393","type":"debug","z":"9b7a138fbdef3f3c","name":"On (true)","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":560,"y":1400,"wires":[]},{"id":"37e4d7a45b669ada","type":"debug","z":"9b7a138fbdef3f3c","name":"On / Off (true/false)","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":590,"y":1440,"wires":[]},{"id":"eb0ae848c39ce94b","type":"debug","z":"9b7a138fbdef3f3c","name":"Off (false)","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":560,"y":1480,"wires":[]},{"id":"b24ccfa09661a404","type":"link in","z":"9b7a138fbdef3f3c","name":"HUE IN","links":["e63309822f6aed33"],"x":150,"y":1680,"wires":[["68baecbeac7c3e04"]],"l":true},{"id":"5319cc544f8b86f0","type":"link in","z":"9b7a138fbdef3f3c","name":"HUE IN","links":["e63309822f6aed33"],"x":150,"y":1920,"wires":[["8fbba406a2f129f3"]],"l":true},{"id":"7d306c301ef5b438","type":"link in","z":"9b7a138fbdef3f3c","name":"HUE IN","links":["e63309822f6aed33"],"x":150,"y":1440,"wires":[["c8a85c32bc5767cc"]],"l":true},{"id":"e3c338ee51333408","type":"function","z":"9b7a138fbdef3f3c","name":"Array Splitter","func":"for (var i = 0; i < msg.payload.data.length; i++) {\n    // Create a deep copy of msg object\n    let splitmsg = JSON.parse(JSON.stringify(msg));\n\n    // Reset data of new message to its single data part\n    splitmsg.payload.data = [msg.payload.data[i]];\n    \n    // send using node\n    node.send(splitmsg);\n}\n\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":360,"wires":[["e63309822f6aed33","013f2b91ba94f484"]]},{"id":"cf0be7ff28bce986","type":"link out","z":"9b7a138fbdef3f3c","name":"API Response OUT","mode":"link","links":["c4e2900916c6fcf3"],"x":1070,"y":520,"wires":[],"l":true},{"id":"c4e2900916c6fcf3","type":"link in","z":"9b7a138fbdef3f3c","name":"BRIDGE DATA RESPONSE IN","links":["cf0be7ff28bce986","3f6d2329.8027ec","29cb5ec00b633749","a810d722e105f7bd"],"x":2245,"y":740,"wires":[["7e16adf527c7b795","ed029c94b1907c2e","2daf5b59504d4639","f2f224d948e95539","5efe17bd6dd91ef3","1a1df9dea9bf6656","b204cfbde2d8194b"]]},{"id":"7e16adf527c7b795","type":"switch","z":"9b7a138fbdef3f3c","name":"Room","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"room","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2550,"y":560,"wires":[["622b8ddc72d3e838","1d7e3c531329198e"]]},{"id":"4fb706a328aed0b6","type":"inject","z":"9b7a138fbdef3f3c","name":"Scenes Zone (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"zone_scenes","payloadType":"flow","x":1810,"y":900,"wires":[["6aab77614dabd1a5"]]},{"id":"d8432847b2e5aaab","type":"change","z":"9b7a138fbdef3f3c","name":"rooms","rules":[{"t":"set","p":"rooms","pt":"flow","to":"keys","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2890,"y":500,"wires":[[]]},{"id":"ed029c94b1907c2e","type":"switch","z":"9b7a138fbdef3f3c","name":"Scene","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"scene","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2550,"y":740,"wires":[["17599b50e21ad7b5","dfd67fe21973ce9b"]]},{"id":"2daf5b59504d4639","type":"switch","z":"9b7a138fbdef3f3c","name":"Light","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"light","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2550,"y":1140,"wires":[["491ebe6780086480"]]},{"id":"f2f224d948e95539","type":"switch","z":"9b7a138fbdef3f3c","name":"Zone","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"zone","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2550,"y":400,"wires":[["886b46117dc1e98a","b3e09f8230e88e18"]]},{"id":"17599b50e21ad7b5","type":"function","z":"9b7a138fbdef3f3c","name":"Scene Name, ID, Zone Name","func":"var response = [];\nvar zones = flow.get(\"zones\") || {};\nvar size = Object.keys(zones).length;\nif(size <= 0) {\n    node.error(\"Please Update Zones First\");\n}\nmsg.payload.data.forEach(function(item){\n    var pair = {\n        \"name\": item.metadata.name,\n        \"id\": item.id,\n        // \"rid\": item.group.rid,\n        // \"rtype\": item.group.rtype,\n        \"zone-name\": zones[item.group.rid]\n    };\n    response.push(pair);\n});\nreturn {\n    \"payload\": response,\n    \"topic\": \"Scene name/rids\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2810,"y":700,"wires":[["ae5c4fc0f4eae237"]]},{"id":"b46d6c449af9fcba","type":"change","z":"9b7a138fbdef3f3c","name":"zones","rules":[{"t":"set","p":"zones","pt":"flow","to":"keys","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2890,"y":340,"wires":[[]]},{"id":"ae5c4fc0f4eae237","type":"subflow:aff9cdb5.1ba04","z":"9b7a138fbdef3f3c","name":"","env":[],"x":2840,"y":740,"wires":[["3af5e027e47a7692","df0d936f4cd9e9f7"],["4d5ca9a052d9c388","dd9bed4f6c9fa3c0"]]},{"id":"3af5e027e47a7692","type":"debug","z":"9b7a138fbdef3f3c","name":"Room Scenes","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3120,"y":700,"wires":[]},{"id":"4d5ca9a052d9c388","type":"debug","z":"9b7a138fbdef3f3c","name":"Zone Scenes","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3110,"y":780,"wires":[]},{"id":"05483d497825b1a7","type":"debug","z":"9b7a138fbdef3f3c","name":"Rooms","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3100,"y":540,"wires":[]},{"id":"c6a0ada63665b222","type":"debug","z":"9b7a138fbdef3f3c","name":"Zones","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3090,"y":380,"wires":[]},{"id":"9cf88d463fc1306c","type":"inject","z":"9b7a138fbdef3f3c","name":"Request all Data","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":1840,"y":200,"wires":[["b8f08184e034a99f","2357a4464cde88d6"]]},{"id":"df0d936f4cd9e9f7","type":"change","z":"9b7a138fbdef3f3c","name":"room_scenes","rules":[{"t":"set","p":"room_scenes","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2860,"y":660,"wires":[[]]},{"id":"2357a4464cde88d6","type":"subflow:d1abcd4.10bc03","z":"9b7a138fbdef3f3c","name":"Request","env":[],"x":2040,"y":200,"wires":[["de410684df035b13"]]},{"id":"dd9bed4f6c9fa3c0","type":"change","z":"9b7a138fbdef3f3c","name":"zone scene","rules":[{"t":"set","p":"zone_scenes","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2870,"y":820,"wires":[[]]},{"id":"6c2babc40984ec37","type":"inject","z":"9b7a138fbdef3f3c","name":"Scenes Zone (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"zone_scenes","payloadType":"flow","x":1820,"y":860,"wires":[["6aab77614dabd1a5"]]},{"id":"067669534d3e3414","type":"inject","z":"9b7a138fbdef3f3c","name":"Scenes Room (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"room_scenes","payloadType":"flow","x":1810,"y":620,"wires":[["6aab77614dabd1a5"]]},{"id":"80a734ef3bc25a8d","type":"inject","z":"9b7a138fbdef3f3c","name":"Scenes Room (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"room_scenes","payloadType":"flow","x":1810,"y":660,"wires":[["6aab77614dabd1a5"]]},{"id":"6aab77614dabd1a5","type":"subflow:7a14643a.75260c","z":"9b7a138fbdef3f3c","name":"","env":[],"x":2220,"y":740,"wires":[["7f39c079c7f29fa1"]]},{"id":"b8f08184e034a99f","type":"change","z":"9b7a138fbdef3f3c","name":"DELETE","rules":[{"t":"delete","p":"zones","pt":"flow"},{"t":"delete","p":"rooms","pt":"flow"},{"t":"delete","p":"lights","pt":"flow"},{"t":"delete","p":"zone_scenes","pt":"flow"},{"t":"delete","p":"room_scenes","pt":"flow"},{"t":"delete","p":"rooms_array","pt":"flow"},{"t":"delete","p":"zones_array","pt":"flow"},{"t":"delete","p":"devices","pt":"flow"},{"t":"delete","p":"motion","pt":"flow"},{"t":"delete","p":"lights","pt":"flow"},{"t":"delete","p":"button","pt":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":2040,"y":240,"wires":[[]]},{"id":"5baba71e1b94c77b","type":"inject","z":"9b7a138fbdef3f3c","d":true,"name":"Delete Data","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":1850,"y":240,"wires":[["b8f08184e034a99f"]]},{"id":"b495b89a89db3a24","type":"change","z":"9b7a138fbdef3f3c","name":"lights","rules":[{"t":"set","p":"lights","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2890,"y":1100,"wires":[[]]},{"id":"da28e5dd9140cabe","type":"debug","z":"9b7a138fbdef3f3c","name":"Lights","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3090,"y":1140,"wires":[]},{"id":"491ebe6780086480","type":"function","z":"9b7a138fbdef3f3c","name":"Light Name, ID, Abilities","func":"var response = [];\nvar rooms = flow.get(\"rooms\") || {};\nvar size = Object.keys(rooms).length;\nif(size <= 0) {\n    node.error(\"Please Update Rooms First\");\n}\nmsg.payload.data.forEach(function(item){\n    var pair = {\n        \"name\": item.metadata.name,\n        \"type\": item.metadata.archetype,\n        \"id\": item.id,\n        \"color\": item.hasOwnProperty(\"color\") ? true : false,\n        \"temp\": item.hasOwnProperty(\"color_temperature\") ? true : false\n    };\n    response.push(pair);\n});\nreturn {\n    \"payload\": response,\n    \"topic\": \"Lights\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2830,"y":1140,"wires":[["b495b89a89db3a24","da28e5dd9140cabe"]]},{"id":"67a0793a85a2fbe0","type":"inject","z":"9b7a138fbdef3f3c","name":"Buttons (an Array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"button","payloadType":"flow","x":1830,"y":1100,"wires":[["6aab77614dabd1a5"]]},{"id":"fd0c82825acb0a28","type":"inject","z":"9b7a138fbdef3f3c","name":"Buttons (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"button","payloadType":"flow","x":1830,"y":1140,"wires":[["6aab77614dabd1a5"]]},{"id":"50431db7b60fcdf8","type":"inject","z":"9b7a138fbdef3f3c","name":"Rooms (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"rooms_array","payloadType":"flow","x":1830,"y":540,"wires":[["6aab77614dabd1a5"]]},{"id":"622b8ddc72d3e838","type":"function","z":"9b7a138fbdef3f3c","name":"Room Name and ID","func":"var response = [];\nvar roomkeys = {};\nmsg.payload.data.forEach(function(item){\n    if(item.services.length > 0) {\n        var pair = {\n            \"name\": item.metadata.name,\n            \"id\": item.id,\n            \"rid\": item.services[0].rid,\n            \"rtype\": item.services[0].rtype\n        };\n        roomkeys[item.id] = item.metadata.name;\n        response.push(pair);\n    }\n});\n\nreturn {\n    \"payload\": response,\n    \"topic\": \"rooms name/rid\",\n    \"keys\": roomkeys\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2840,"y":540,"wires":[["d8432847b2e5aaab","05483d497825b1a7"]]},{"id":"5efe17bd6dd91ef3","type":"switch","z":"9b7a138fbdef3f3c","name":"Device","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"device","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2550,"y":900,"wires":[["336fc15ea2bbdd2e"]]},{"id":"336fc15ea2bbdd2e","type":"function","z":"9b7a138fbdef3f3c","name":"Devices Button and Motion","func":"// NOTE: Devices have multipe rtypes in the services\n// This script grabs the first one, so a motion sensor may show\n// up as \"temperature\" as it also does temp. don't worry\n// this script is more to get the name of the devices to help\n// with the button/motion scripts.\nvar response = [];\nvar devices = {};\nmsg.payload.data.forEach(function(item){\n    try {\n        if(item.metadata.archetype == \"unknown_archetype\") {\n            var pair = {\n                \"name\": item.metadata.name,\n                \"id\": item.id,\n                \"rid\": item.services[0].rid,\n                \"rtype\": item.services[0].rtype\n            };\n            devices[item.id] = item.metadata.name;\n            response.push(pair);\n        }\n    } catch(err) {\n        node.warn(err);\n    }\n});\n\nreturn {\n    \"payload\": response,\n    \"topic\": \"devices name/rid\",\n    \"keys\": devices\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2820,"y":900,"wires":[["729c293fab508605","4a539d3eb82bb629"]]},{"id":"729c293fab508605","type":"change","z":"9b7a138fbdef3f3c","name":"devices","rules":[{"t":"set","p":"devices","pt":"flow","to":"keys","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2880,"y":860,"wires":[[]]},{"id":"b3e09f8230e88e18","type":"function","z":"9b7a138fbdef3f3c","name":"Zone Name and ID","func":"var response = [];\nvar roomkeys = {};\nmsg.payload.data.forEach(function(item){\n    if(item.hasOwnProperty(\"services\")) {\n        var pair = {\n            \"name\": item.metadata.name,\n            \"id\": item.id,\n            \"rid\": item.services[0].rid,\n            \"rtype\": item.services[0].rtype\n        };\n        roomkeys[item.id] = item.metadata.name;\n        response.push(pair);\n    }\n});\n\nreturn {\n    \"payload\": response,\n    \"topic\": \"zones name/rid\",\n    \"keys\": roomkeys\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2850,"y":380,"wires":[["b46d6c449af9fcba","c6a0ada63665b222"]]},{"id":"886b46117dc1e98a","type":"function","z":"9b7a138fbdef3f3c","name":"Zone Name and ID (array)","func":"var response = [];\nmsg.payload.data.forEach(function(item){\n    if(item.services.length > 0) {\n        var pair = {\n            \"name\": item.metadata.name,\n            \"id\": item.id,\n            \"rid\": item.services[0].rid,\n            \"rtype\": item.services[0].rtype\n        };\n         response.push(pair);\n    }\n});\n\nreturn {\n    \"payload\": response,\n    \"topic\": \"zones name/rid\",\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2830,"y":420,"wires":[["e457c3b8e58b5527"]]},{"id":"dfd67fe21973ce9b","type":"function","z":"9b7a138fbdef3f3c","name":"Scene Name, ID, Room Name","func":"var response = [];\nvar rooms = flow.get(\"rooms\") || {};\nvar size = Object.keys(rooms).length;\nif(size <= 0) {\n    node.error(\"Please Update Rooms First\");\n}\nmsg.payload.data.forEach(function(item){\n    var pair = {\n        \"name\": item.metadata.name,\n        \"id\": item.id,\n        // \"rid\": item.group.rid,\n        // \"rtype\": item.group.rtype,\n        \"room-name\": rooms[item.group.rid]\n    };\n    response.push(pair);\n});\nreturn {\n    \"payload\": response,\n    \"topic\": \"Scene name/rids\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2810,"y":780,"wires":[["ae5c4fc0f4eae237"]]},{"id":"1d7e3c531329198e","type":"function","z":"9b7a138fbdef3f3c","name":"Room Name and ID (array)","func":"var response = [];\nmsg.payload.data.forEach(function(item){\n    if(item.services.length > 0) {\n        var pair = {\n            \"name\": item.metadata.name,\n            \"id\": item.id,\n            \"rid\": item.services[0].rid,\n            \"rtype\": item.services[0].rtype\n        };\n         response.push(pair);\n    }\n});\n\nreturn {\n    \"payload\": response,\n    \"topic\": \"rooms name/rid\",\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2820,"y":580,"wires":[["11bfb7244b5b7faf"]]},{"id":"11bfb7244b5b7faf","type":"change","z":"9b7a138fbdef3f3c","name":"rooms_array","rules":[{"t":"set","p":"rooms_array","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2870,"y":620,"wires":[[]]},{"id":"e457c3b8e58b5527","type":"change","z":"9b7a138fbdef3f3c","name":"zones_array","rules":[{"t":"set","p":"zones_array","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2870,"y":460,"wires":[[]]},{"id":"3102d3447130c11e","type":"inject","z":"9b7a138fbdef3f3c","name":"Rooms (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"rooms_array","payloadType":"flow","x":1840,"y":500,"wires":[["6aab77614dabd1a5"]]},{"id":"7f39c079c7f29fa1","type":"debug","z":"9b7a138fbdef3f3c","name":"API V2 DATA","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2230,"y":700,"wires":[]},{"id":"f50c82b18de5d1b6","type":"inject","z":"9b7a138fbdef3f3c","name":"Zones (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"zones_array","payloadType":"flow","x":1830,"y":780,"wires":[["6aab77614dabd1a5"]]},{"id":"cd446f6f9ef8616d","type":"inject","z":"9b7a138fbdef3f3c","name":"Zones (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"zones_array","payloadType":"flow","x":1840,"y":740,"wires":[["6aab77614dabd1a5"]]},{"id":"4a539d3eb82bb629","type":"debug","z":"9b7a138fbdef3f3c","name":"Devices","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3100,"y":900,"wires":[]},{"id":"1a1df9dea9bf6656","type":"switch","z":"9b7a138fbdef3f3c","name":"Motion","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"motion","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2550,"y":980,"wires":[["10e97f7f5d5baf91"]]},{"id":"10e97f7f5d5baf91","type":"function","z":"9b7a138fbdef3f3c","name":"Motion Name, ID, Device Name","func":"var response = [];\nvar devices = flow.get(\"devices\") || {};\nvar size = Object.keys(devices).length;\nif(size <= 0) {\n    node.error(\"Please Update Devices First\");\n}\nmsg.payload.data.forEach(function(item){\n    var pair = {\n        \"Device\": devices[item.owner.rid],\n        \"id\": item.id,\n        \"type\": item.type,\n    };\n    response.push(pair);\n});\nreturn {\n    \"payload\": response,\n    \"topic\": \"Motion name/rids\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2810,"y":980,"wires":[["5e389697203c9cdf","25ca3e5cde9c8d4f"]]},{"id":"5e389697203c9cdf","type":"debug","z":"9b7a138fbdef3f3c","name":"Motion","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3090,"y":980,"wires":[]},{"id":"25ca3e5cde9c8d4f","type":"change","z":"9b7a138fbdef3f3c","name":"motion","rules":[{"t":"set","p":"motion","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2890,"y":940,"wires":[[]]},{"id":"d815b83871bdf11e","type":"inject","z":"9b7a138fbdef3f3c","name":"Motion Senors (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"motion","payloadType":"flow","x":1810,"y":1020,"wires":[["6aab77614dabd1a5"]]},{"id":"0af99ff183524f51","type":"inject","z":"9b7a138fbdef3f3c","name":"Motion Sensors (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"motion","payloadType":"flow","x":1810,"y":980,"wires":[["6aab77614dabd1a5"]]},{"id":"b204cfbde2d8194b","type":"switch","z":"9b7a138fbdef3f3c","name":"Button","property":"endpoint","propertyType":"msg","rules":[{"t":"eq","v":"button","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2550,"y":1060,"wires":[["ab6104681c4a361c"]]},{"id":"f26e098dca4e8920","type":"inject","z":"9b7a138fbdef3f3c","name":"Lights (seperately)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"split","payload":"lights","payloadType":"flow","x":1830,"y":420,"wires":[["6aab77614dabd1a5"]]},{"id":"27666e44e6e67ee9","type":"inject","z":"9b7a138fbdef3f3c","name":"Lights (an array)","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"array","payload":"lights","payloadType":"flow","x":1840,"y":380,"wires":[["6aab77614dabd1a5"]]},{"id":"ab6104681c4a361c","type":"function","z":"9b7a138fbdef3f3c","name":"Button Name, ID, Device Name","func":"var response = [];\nvar devices = flow.get(\"devices\") || {};\nvar size = Object.keys(devices).length;\nif(size <= 0) {\n    node.error(\"Please Update Devices First\");\n}\nmsg.payload.data.forEach(function(item){\n    var pair = {\n        \"Device\": devices[item.owner.rid],\n        \"id\": item.id,\n        \"type\": item.type,\n    };\n    response.push(pair);\n});\nreturn {\n    \"payload\": response,\n    \"topic\": \"Motion name/rids\"\n};","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2810,"y":1060,"wires":[["1099a4350312b614","79b8860c56d49a75"]]},{"id":"1099a4350312b614","type":"change","z":"9b7a138fbdef3f3c","name":"button","rules":[{"t":"set","p":"button","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2890,"y":1020,"wires":[[]]},{"id":"79b8860c56d49a75","type":"debug","z":"9b7a138fbdef3f3c","name":"Button","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3090,"y":1060,"wires":[]},{"id":"6a12968575fd96c3","type":"comment","z":"9b7a138fbdef3f3c","name":"Bridge Data","info":"","x":2230,"y":740,"wires":[]},{"id":"69c84fbfc395f0c8","type":"comment","z":"9b7a138fbdef3f3c","name":"DO NOT CHANGE ANYTHING HERE","info":"","x":2210,"y":560,"wires":[]},{"id":"dd8b88ceebf10282","type":"debug","z":"9b7a138fbdef3f3c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1050,"y":480,"wires":[]},{"id":"49175a8a588b0bbb","type":"http request","z":"9b7a138fbdef3f3c","name":"HUE API V2","method":"use","ret":"obj","paytoqs":"ignore","url":"","tls":"4bc31af9bd03bbdc","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":830,"y":520,"wires":[["dd8b88ceebf10282","cf0be7ff28bce986"]]},{"id":"f8180736d0fe208c","type":"comment","z":"9b7a138fbdef3f3c","name":"Add your Data here \\n IP and Username","info":"","x":590,"y":460,"wires":[]},{"id":"b742e8eb3da9960e","type":"function","z":"9b7a138fbdef3f3c","name":"HEADER V2","func":"// var user is your discovered username, var ip the IP adress of your bridge\nvar user = \"API USERNAME\";\nvar ip = \"YOUR IP\"\n\nif(msg.endpoint === undefined)\n msg.url = \"https://\" + ip + \"/clip/v2/resource\";\nelse if(msg.topic === undefined)\n msg.url = \"https://\" + ip + \"/clip/v2/resource/\" + msg.endpoint;\nelse\n msg.url = \"https://\" + ip + \"/clip/v2/resource/\" + msg.endpoint + \"/\" + msg.topic;\n\nmsg.headers = {};\n\nmsg.headers['hue-application-key'] = user;\nmsg.headers['Content-Type'] = 'application/json';\nmsg.headers['Accept'] = 'application/json';\n\nif(msg.payload != undefined)\n msg.headers['ContentLength'] = JSON.stringify(msg.payload).length;\n\nif(msg.verb === undefined)\n msg.method = \"get\";\nelse\n msg.method = msg.verb;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":520,"wires":[["49175a8a588b0bbb"]]},{"id":"de410684df035b13","type":"link out","z":"9b7a138fbdef3f3c","name":"Discover Out","mode":"link","links":["9f64469aa4b2d6a9","327d7e6fb89532d2"],"x":2145,"y":200,"wires":[]},{"id":"9f64469aa4b2d6a9","type":"link in","z":"9b7a138fbdef3f3c","name":"HUE API INPUT","links":["de410684df035b13","6020f802750ac20a"],"x":360,"y":520,"wires":[["b742e8eb3da9960e"]],"l":true},{"id":"83f67f11c717b816","type":"function","z":"9b7a138fbdef3f3c","name":"HEADER V2","func":"// you can copy the user key from the hue config node out of Huemagic\nvar user = \"API USERNAME\";\nvar ip = \"YOUR IP\"\n\nif(msg.endpoint === undefined)\n msg.url = \"https://\" + ip + \"/clip/v2/resource\";\nelse if(msg.topic === undefined)\n msg.url = \"https://\" + ip + \"/clip/v2/resource/\" + msg.endpoint;\nelse\n msg.url = \"https://\" + ip + \"/clip/v2/resource/\" + msg.endpoint + \"/\" + msg.topic;\n\nmsg.headers = {};\n\nmsg.headers['hue-application-key'] = user;\nmsg.headers['Content-Type'] = 'application/json';\nmsg.headers['Accept'] = 'application/json';\n\nif(msg.payload != undefined)\n msg.headers['ContentLength'] = JSON.stringify(msg.payload).length;\n\nif(msg.verb === undefined)\n msg.method = \"get\";\nelse\n msg.method = msg.verb;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":860,"wires":[["a9da3aa95f69b164"]]},{"id":"24d38b95c9070816","type":"comment","z":"9b7a138fbdef3f3c","name":"Add your Data here","info":"","x":410,"y":820,"wires":[]},{"id":"1f8ab5d8de0d1a30","type":"change","z":"9b7a138fbdef3f3c","name":"API KEY","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"devicetype\":\"nodered\",\"generateclientkey\":true}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":200,"wires":[["f8877427505e83a3"]]},{"id":"6f464832594587b9","type":"inject","z":"9b7a138fbdef3f3c","name":"Request","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":360,"y":200,"wires":[["1f8ab5d8de0d1a30"]]},{"id":"0854d605af15fdc9","type":"debug","z":"9b7a138fbdef3f3c","name":"API KEY","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1040,"y":200,"wires":[]},{"id":"f8877427505e83a3","type":"http request","z":"9b7a138fbdef3f3c","name":"HUE Bridge IP","method":"POST","ret":"obj","paytoqs":"ignore","url":"https://your.IP.here/api","tls":"4bc31af9bd03bbdc","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":840,"y":200,"wires":[["0854d605af15fdc9"]]},{"id":"cae0533117cca735","type":"comment","z":"9b7a138fbdef3f3c","name":"Add your IP here","info":"","x":840,"y":160,"wires":[]},{"id":"7c7dd5f4247ea762","type":"comment","z":"9b7a138fbdef3f3c","name":"Request new API KEY (username) \\n press the button on your Bridge and request \\n !! ADD IP FIRST !! -------------------------->>> ","info":"","x":430,"y":120,"wires":[]},{"id":"dd0309874f2c5060","type":"comment","z":"9b7a138fbdef3f3c","name":"This is a different approach that can be used when \\n the step3 http request causes connection issues","info":"","x":690,"y":760,"wires":[]},{"id":"abdbf772b8563ecd","type":"comment","z":"9b7a138fbdef3f3c","name":"username","info":"","x":1040,"y":160,"wires":[]},{"id":"c215b086155a7b6f","type":"comment","z":"9b7a138fbdef3f3c","name":"Step 1","info":"","x":150,"y":200,"wires":[]},{"id":"01fdc60658ca81f4","type":"comment","z":"9b7a138fbdef3f3c","name":"Step 2","info":"","x":150,"y":360,"wires":[]},{"id":"4d72730cb8252666","type":"comment","z":"9b7a138fbdef3f3c","name":"Step 3","info":"","x":150,"y":520,"wires":[]},{"id":"3dae2189eae96f76","type":"comment","z":"9b7a138fbdef3f3c","name":"Step 4","info":"","x":1930,"y":80,"wires":[]},{"id":"5540d1cc1faeec08","type":"comment","z":"9b7a138fbdef3f3c","name":"Step 3.b","info":"","x":160,"y":800,"wires":[]},{"id":"28cc69a734a25b25","type":"comment","z":"9b7a138fbdef3f3c","name":"Configure this Node \\n IP and Username","info":"","x":350,"y":300,"wires":[]},{"id":"700fd44d51bda617","type":"comment","z":"9b7a138fbdef3f3c","name":"This will request all Data fron the Bridge, \\n just click the Inject node and wait 15 seconds","info":"","x":1930,"y":140,"wires":[]},{"id":"598077a187bc64f8","type":"comment","z":"9b7a138fbdef3f3c","name":"After you requested the Data \\n use the Inject Nodes to get ID / RID \\n the Data will apear in the Debug Window","info":"","x":2220,"y":480,"wires":[]},{"id":"0659e37abd6f5d74","type":"comment","z":"9b7a138fbdef3f3c","name":"To get responses from lamps / rooms / \\n zones add your discovered ID / RID here \\n - for a lamp you need to add the ID \\n - for a room / zone you need to add the RID \\n you need one subflow for every lamp or room","info":"","x":270,"y":1340,"wires":[]},{"id":"b84306f7c1c78c63","type":"comment","z":"9b7a138fbdef3f3c","name":"Step 5","info":"","x":2230,"y":400,"wires":[]},{"id":"9303a251a77475ba","type":"comment","z":"9b7a138fbdef3f3c","name":"To get responses from motion sensors\\n add your discovered ID here \\n you need one subflow for every sensor ","info":"","x":250,"y":1600,"wires":[]},{"id":"a62fd90a2690e1dd","type":"comment","z":"9b7a138fbdef3f3c","name":"To get responses from buttons \\n add your discovered ID here \\n you need one subflow for every button","info":"","x":250,"y":1840,"wires":[]},{"id":"ae46c4d0d1d7eb33","type":"change","z":"9b7a138fbdef3f3c","name":"Dimming 10% down / 1s transition","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"dynamics\":{\"duration\":1000},\"dimming_delta\":{\"action\":\"down\",\"brightness_delta\":10}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":1380,"wires":[["6020f802750ac20a"]]},{"id":"0e8b06beb0e9922a","type":"change","z":"9b7a138fbdef3f3c","name":"Light off / 1s transition","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":false},\"dynamics\":{\"duration\":1000}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1480,"y":1460,"wires":[["6020f802750ac20a"]]},{"id":"5e7f3955d97ba283","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":1380,"wires":[["ae46c4d0d1d7eb33"]]},{"id":"f69cd3fbe5b2813e","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":1340,"wires":[["3d8abd33a17fc81c"]]},{"id":"c40f6797e59018bb","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":1460,"wires":[["0e8b06beb0e9922a"]]},{"id":"3d8abd33a17fc81c","type":"change","z":"9b7a138fbdef3f3c","name":"Light on / 100% / orange / 1s transition","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":true},\"dimming\":{\"brightness\":100},\"dynamics\":{\"duration\":1000},\"color\":{\"xy\":{\"x\":0.6101,\"y\":0.3662}}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1430,"y":1340,"wires":[["6020f802750ac20a"]]},{"id":"d9ff70d3ce5833b2","type":"change","z":"9b7a138fbdef3f3c","name":"Dimming 10% up / 1s transition","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"dynamics\":{\"duration\":1000},\"dimming_delta\":{\"action\":\"up\",\"brightness_delta\":10}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":1420,"wires":[["6020f802750ac20a"]]},{"id":"9b4ee41ce9e60593","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":1420,"wires":[["d9ff70d3ce5833b2"]]},{"id":"3b08aaf1adf79b7a","type":"change","z":"9b7a138fbdef3f3c","name":"Light on / 100% / red / alert flashing","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":true},\"dimming\":{\"brightness\":100},\"color\":{\"xy\":{\"x\":0.7,\"y\":0.25}},\"alert\":{\"action\":\"breathe\"}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1440,"y":1500,"wires":[["6020f802750ac20a"]]},{"id":"a26f71496d42df42","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":1500,"wires":[["3b08aaf1adf79b7a"]]},{"id":"e96582fe6a82c3fa","type":"change","z":"9b7a138fbdef3f3c","name":"Light on / 80% / 2s transition / color temp cold 153","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":true},\"dimming\":{\"brightness\":80},\"dynamics\":{\"duration\":2000},\"color_temperature\":{\"mirek\":153}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1390,"y":1540,"wires":[["6020f802750ac20a"]]},{"id":"483e4059c8224454","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":1540,"wires":[["e96582fe6a82c3fa"]]},{"id":"effb51028d347757","type":"change","z":"9b7a138fbdef3f3c","name":"Light on / 50% / 1s transition / color temp warm 500","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":true},\"dimming\":{\"brightness\":50},\"dynamics\":{\"duration\":1000},\"color_temperature\":{\"mirek\":500}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1390,"y":1580,"wires":[["6020f802750ac20a"]]},{"id":"b37d17ef853c52c1","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":1580,"wires":[["effb51028d347757"]]},{"id":"7a5cf973659f5ba3","type":"change","z":"9b7a138fbdef3f3c","name":"Room or Zone on / 100% / orange / 1s transition","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"grouped_light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"replace with discovered !!!>> RID <<!!!","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":true},\"dimming\":{\"brightness\":100},\"dynamics\":{\"duration\":1000},\"color\":{\"xy\":{\"x\":0.6101,\"y\":0.3662}}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":1700,"wires":[["6020f802750ac20a"]]},{"id":"401d98a431c582ad","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":1700,"wires":[["7a5cf973659f5ba3"]]},{"id":"939772d3f39e6a8e","type":"comment","z":"9b7a138fbdef3f3c","name":"grouped_light - DOUBLE CLICK FOR INFO","info":"(Rooms & Zones) can be controlled in almost the samme way as lights. \n\nJust the endpoint in the change node is different and instead of \nusing the ID of a Room / Zone you need to use the discoverd **rid **\n\ngrouped_light is a service (rid) that is connected to the group/zone ID","x":1180,"y":1660,"wires":[]},{"id":"d6e41c216fea6d40","type":"change","z":"9b7a138fbdef3f3c","name":"Motion Sensor DISABLED","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"motion","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"enabled\":false}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1470,"y":2040,"wires":[["6020f802750ac20a"]]},{"id":"46bde4318f41f4ef","type":"change","z":"9b7a138fbdef3f3c","name":"Motion Sensor ENABLED","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"motion","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"enabled\":true}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1470,"y":2000,"wires":[["6020f802750ac20a"]]},{"id":"456d71aea0f89b78","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":2040,"wires":[["d6e41c216fea6d40"]]},{"id":"96e93e1ebbbb7d45","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":2000,"wires":[["46bde4318f41f4ef"]]},{"id":"fdc55144166fc8a1","type":"comment","z":"9b7a138fbdef3f3c","name":"Motion Sensor ENABLED / DISABLED","info":"","x":1170,"y":1960,"wires":[]},{"id":"7682a9ed95fe2182","type":"change","z":"9b7a138fbdef3f3c","name":"Recall a Scene","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"scene","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Replace with your discovered ID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"recall\":{\"action\":\"active\"}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":1780,"wires":[["6020f802750ac20a"]],"icon":"font-awesome/fa-star"},{"id":"c0e7d435d50a65a2","type":"change","z":"9b7a138fbdef3f3c","name":"Room or Zone off","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"grouped_light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"replace with discovered !!!>> RID <<!!!","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":false}}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"put","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1490,"y":1740,"wires":[["6020f802750ac20a"]]},{"id":"3911a4e768fe0aaa","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":1740,"wires":[["c0e7d435d50a65a2"]]},{"id":"7d41abdce6299ba8","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":1780,"wires":[["7682a9ed95fe2182"]]},{"id":"b195bda64dcceafc","type":"comment","z":"9b7a138fbdef3f3c","name":"Recall a Scene - DOUBLE CLICK FOR INFO","info":"I highly recommend to use Scenes to turn on Rooms/Zones. \nThis is just one request to the Bridge and the rest is \nprocessed in the bridge. When 4 lights are turned on simultanious, \nthe bridge possible wont be able to handle these requests at once.\n\nIf you have a setup where it is needed to turn on seperate lights, \nthen add delay nodes i front of the chhange node. \n\nExample: 4 Lights need to be tunes on, \nlight 1 = no delay\nlight 2 = 200ms delay\nlight 3 = 400ms delay\nlight 4 = 600ms delay\n\nwhen turning light off simultanious, this should be done in this way.\nBetter is to turn off Rooms or Zones with one request.","x":1190,"y":1820,"wires":[]},{"id":"452eae4cebb77585","type":"change","z":"9b7a138fbdef3f3c","name":"Get State","rules":[{"t":"set","p":"endpoint","pt":"msg","to":"grouped_light","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"ADD GROUP RID","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"{}","tot":"json"},{"t":"set","p":"verb","pt":"msg","to":"get","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1520,"y":2160,"wires":[["6020f802750ac20a"]]},{"id":"d430e64f35224cc0","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":2160,"wires":[["452eae4cebb77585"]]},{"id":"0cd6d0bc2ba5f4d4","type":"comment","z":"9b7a138fbdef3f3c","name":"Get state of a Group","info":"","x":1110,"y":2120,"wires":[]},{"id":"6020f802750ac20a","type":"link out","z":"9b7a138fbdef3f3c","name":"actions out","mode":"link","links":["9f64469aa4b2d6a9","327d7e6fb89532d2"],"x":1865,"y":1760,"wires":[]},{"id":"d4e609b0ba095d8b","type":"comment","z":"9b7a138fbdef3f3c","name":"Step 6","info":"","x":150,"y":1220,"wires":[]},{"id":"0f32befdc9b64e5e","type":"comment","z":"9b7a138fbdef3f3c","name":"These are pre-configured actions \\n add the ID / RID and try it out \\n with this samples it should be easy \\n to create all the actions you need","info":"","x":1480,"y":1900,"wires":[]},{"id":"c903165350261d36","type":"comment","z":"9b7a138fbdef3f3c","name":"----- CONTROLLING -----","info":"","x":1250,"y":1220,"wires":[]},{"id":"23dcc4641ec539d0","type":"comment","z":"9b7a138fbdef3f3c","name":"----- STATUS UPDATES -----","info":"","x":340,"y":1220,"wires":[]},{"id":"c158bf8ddc0400e2","type":"change","z":"9b7a138fbdef3f3c","name":"Gradient Stripe","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"on\":{\"on\":true},\"dimming\":{\"brightness\":100},\"gradient\":{\"points\":[{\"color\":{\"xy\":{\"x\":0.6712,\"y\":0.2984}}},{\"color\":{\"xy\":{\"x\":0.4975,\"y\":0.3572}}},{\"color\":{\"xy\":{\"x\":0.4028,\"y\":0.3948}}},{\"color\":{\"xy\":{\"x\":0.424,\"y\":0.4396}}},{\"color\":{\"xy\":{\"x\":0.28,\"y\":0.6174}}}]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1500,"y":2280,"wires":[["6020f802750ac20a"]]},{"id":"c258f8d767c8193a","type":"comment","z":"9b7a138fbdef3f3c","name":"Gradient Stripe","info":"","x":1100,"y":2240,"wires":[]},{"id":"235364fdfcb79f7b","type":"inject","z":"9b7a138fbdef3f3c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1080,"y":2280,"wires":[["c158bf8ddc0400e2"]]},{"id":"972420b095fde2ea","type":"comment","z":"9b7a138fbdef3f3c","name":"Lights - Node name describes what it does, add your IDs","info":"","x":1230,"y":1300,"wires":[]},{"id":"da1dd8c21e046d67","type":"comment","z":"9b7a138fbdef3f3c","name":"Step 7","info":"","x":1070,"y":1220,"wires":[]},{"id":"4bc31af9bd03bbdc","type":"tls-config","name":"","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","servername":"","verifyservercert":false}]
